/*
Deployment script for Test123

This code was generated by a tool.
Changes to this file may cause incorrect behavior and will be lost if
the code is regenerated.
*/

GO
SET ANSI_NULLS, ANSI_PADDING, ANSI_WARNINGS, ARITHABORT, CONCAT_NULL_YIELDS_NULL, QUOTED_IDENTIFIER ON;

SET NUMERIC_ROUNDABORT OFF;


GO
:setvar DatabaseName "Test123"
:setvar DefaultFilePrefix "Test123"
:setvar DefaultDataPath "C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQL2014MDX\MSSQL\DATA\"
:setvar DefaultLogPath "C:\Program Files\Microsoft SQL Server\MSSQL12.MSSQL2014MDX\MSSQL\DATA\"

GO
:on error exit
GO
/*
Detect SQLCMD mode and disable script execution if SQLCMD mode is not supported.
To re-enable the script after enabling SQLCMD mode, execute the following:
SET NOEXEC OFF; 
*/
:setvar __IsSqlCmdEnabled "True"
GO
IF N'$(__IsSqlCmdEnabled)' NOT LIKE N'True'
    BEGIN
        PRINT N'SQLCMD mode must be enabled to successfully execute this script.';
        SET NOEXEC ON;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET ANSI_NULLS ON,
                ANSI_PADDING ON,
                ANSI_WARNINGS ON,
                ARITHABORT ON,
                CONCAT_NULL_YIELDS_NULL ON,
                QUOTED_IDENTIFIER ON,
                ANSI_NULL_DEFAULT ON,
                CURSOR_DEFAULT LOCAL 
            WITH ROLLBACK IMMEDIATE;
    END


GO
IF EXISTS (SELECT 1
           FROM   [master].[dbo].[sysdatabases]
           WHERE  [name] = N'$(DatabaseName)')
    BEGIN
        ALTER DATABASE [$(DatabaseName)]
            SET PAGE_VERIFY NONE 
            WITH ROLLBACK IMMEDIATE;
    END


GO
USE [$(DatabaseName)];


GO
PRINT N'Creating [dwh]...';


GO
CREATE SCHEMA [dwh]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [stg]...';


GO
CREATE SCHEMA [stg]
    AUTHORIZATION [dbo];


GO
PRINT N'Creating [dwh].[DimDate]...';


GO
CREATE TABLE [dwh].[DimDate] (
    [DateSK]                   INT           NOT NULL,
    [DateBK]                   DATE          NULL,
    [CalendarMonth]            SMALLINT      NULL,
    [CalendarMonthLongName]    NVARCHAR (9)  NULL,
    [CalendarMonthShortName]   NVARCHAR (3)  NULL,
    [CalendarQuarter]          SMALLINT      NULL,
    [CalendarQuarterShortName] NVARCHAR (2)  NULL,
    [CalendarYear]             NVARCHAR (4)  NULL,
    [CalendarYearMonth]        NVARCHAR (7)  NULL,
    [CalendarYearQuarter]      NVARCHAR (10) NULL,
    [DayLongName]              NVARCHAR (9)  NULL,
    [DayShortName]             NVARCHAR (3)  NULL,
    [DayWeekNumber]            SMALLINT      NULL,
    CONSTRAINT [PK_DimDate] PRIMARY KEY CLUSTERED ([DateSK] ASC)
);


GO
PRINT N'Creating [dwh].[DimGeography]...';


GO
CREATE TABLE [dwh].[DimGeography] (
    [DimGeographyKey] INT            IDENTITY (1, 1) NOT NULL,
    [Region]          NVARCHAR (255) NULL,
    [SubRegion]       NVARCHAR (255) NULL,
    [Country]         NVARCHAR (255) NULL,
    [SysDateCreated]  DATETIME       NULL,
    [SysDateChanged]  DATETIME       NULL,
    PRIMARY KEY CLUSTERED ([DimGeographyKey] ASC)
);


GO
PRINT N'Creating [dwh].[DimGeographySCD]...';


GO
CREATE TABLE [dwh].[DimGeographySCD] (
    [DimCountryKey]   INT            IDENTITY (1, 1) NOT NULL,
    [Region]          NVARCHAR (255) NULL,
    [SubRegion]       NVARCHAR (255) NULL,
    [Country]         NVARCHAR (255) NULL,
    [IsCurrent]       BIT            NULL,
    [DateStart]       DATETIME       NULL,
    [DateEnd]         DATETIME       NULL,
    [sysDateCreated]  DATETIME       NULL,
    [sysDateModified] DATETIME       NULL,
    CONSTRAINT [PK_dwh_DimGeographySCD] PRIMARY KEY CLUSTERED ([DimCountryKey] ASC)
);


GO
PRINT N'Creating [dwh].[FactCrime]...';


GO
CREATE TABLE [dwh].[FactCrime] (
    [FactCrimeKey]    INT      IDENTITY (1, 1) NOT NULL,
    [DimDateKey]      INT      NOT NULL,
    [DimGeographyKey] INT      NOT NULL,
    [DimCrimeTypeKey] INT      NOT NULL,
    [CrimeCount]      INT      NOT NULL,
    [SysDateCreated]  DATETIME NULL,
    [SysDateChanged]  DATETIME NULL,
    PRIMARY KEY CLUSTERED ([FactCrimeKey] ASC)
);


GO
PRINT N'Creating [dwh].[FactPopulation]...';


GO
CREATE TABLE [dwh].[FactPopulation] (
    [FactPopulationKey] INT      IDENTITY (1, 1) NOT NULL,
    [DimDateKey]        INT      NOT NULL,
    [DimGeographyKey]   INT      NOT NULL,
    [PopulationCount]   BIGINT   NOT NULL,
    [SysDateCreated]    DATETIME NULL,
    [SysDateChanged]    DATETIME NULL,
    PRIMARY KEY CLUSTERED ([FactPopulationKey] ASC)
);


GO
PRINT N'Creating [dwh].[DimCrimeType]...';


GO
CREATE TABLE [dwh].[DimCrimeType] (
    [DimCrimeTypeKey] INT            IDENTITY (1, 1) NOT NULL,
    [CrimeTypeName]   NVARCHAR (255) NULL,
    [SysDateCreated]  DATETIME       NULL,
    [SysDateChanged]  DATETIME       NULL,
    PRIMARY KEY CLUSTERED ([DimCrimeTypeKey] ASC)
);


GO
PRINT N'Creating [stg].[UNCrimeData_Cleaned]...';


GO
CREATE TABLE [stg].[UNCrimeData_Cleaned] (
    [UNCrimeDataKey] INT            IDENTITY (1, 1) NOT NULL,
    [Region]         NVARCHAR (255) NULL,
    [SubRegion]      NVARCHAR (255) NULL,
    [Country]        NVARCHAR (255) NULL,
    [total2003]      NVARCHAR (255) NULL,
    [total2004]      NVARCHAR (255) NULL,
    [total2005]      NVARCHAR (255) NULL,
    [total2006]      NVARCHAR (255) NULL,
    [total2007]      NVARCHAR (255) NULL,
    [total2008]      NVARCHAR (255) NULL,
    [total2009]      NVARCHAR (255) NULL,
    [total2010]      NVARCHAR (255) NULL,
    [total2011]      NVARCHAR (255) NULL,
    [total2012]      NVARCHAR (255) NULL,
    [total2013]      NVARCHAR (255) NULL,
    [total2014]      NVARCHAR (255) NULL,
    [rate2003]       NVARCHAR (255) NULL,
    [rate2004]       NVARCHAR (255) NULL,
    [rate2005]       NVARCHAR (255) NULL,
    [rate2006]       NVARCHAR (255) NULL,
    [rate2007]       NVARCHAR (255) NULL,
    [rate2008]       NVARCHAR (255) NULL,
    [rate2009]       NVARCHAR (255) NULL,
    [rate2010]       NVARCHAR (255) NULL,
    [rate2011]       NVARCHAR (255) NULL,
    [rate2012]       NVARCHAR (255) NULL,
    [rate2013]       NVARCHAR (255) NULL,
    [rate2014]       NVARCHAR (255) NULL,
    [SysDateCreated] DATETIME       NULL,
    [SysSourceName]  NVARCHAR (255) NULL,
    CONSTRAINT [PK_stg_UNCrimeData_Cleaned] PRIMARY KEY CLUSTERED ([UNCrimeDataKey] ASC)
);


GO
PRINT N'Creating [stg].[WBPopulationData_Cleaned]...';


GO
CREATE TABLE [stg].[WBPopulationData_Cleaned] (
    [WBPopulationDataKey] INT            IDENTITY (1, 1) NOT NULL,
    [CountryName]         NVARCHAR (255) NULL,
    [CountryCode]         NVARCHAR (255) NULL,
    [IndicatorName]       NVARCHAR (255) NULL,
    [IndicatorCode]       NVARCHAR (255) NULL,
    [1960]                NVARCHAR (255) NULL,
    [1961]                NVARCHAR (255) NULL,
    [1962]                NVARCHAR (255) NULL,
    [1963]                NVARCHAR (255) NULL,
    [1964]                NVARCHAR (255) NULL,
    [1965]                NVARCHAR (255) NULL,
    [1966]                NVARCHAR (255) NULL,
    [1967]                NVARCHAR (255) NULL,
    [1968]                NVARCHAR (255) NULL,
    [1969]                NVARCHAR (255) NULL,
    [1970]                NVARCHAR (255) NULL,
    [1971]                NVARCHAR (255) NULL,
    [1972]                NVARCHAR (255) NULL,
    [1973]                NVARCHAR (255) NULL,
    [1974]                NVARCHAR (255) NULL,
    [1975]                NVARCHAR (255) NULL,
    [1976]                NVARCHAR (255) NULL,
    [1977]                NVARCHAR (255) NULL,
    [1978]                NVARCHAR (255) NULL,
    [1979]                NVARCHAR (255) NULL,
    [1980]                NVARCHAR (255) NULL,
    [1981]                NVARCHAR (255) NULL,
    [1982]                NVARCHAR (255) NULL,
    [1983]                NVARCHAR (255) NULL,
    [1984]                NVARCHAR (255) NULL,
    [1985]                NVARCHAR (255) NULL,
    [1986]                NVARCHAR (255) NULL,
    [1987]                NVARCHAR (255) NULL,
    [1988]                NVARCHAR (255) NULL,
    [1989]                NVARCHAR (255) NULL,
    [1990]                NVARCHAR (255) NULL,
    [1991]                NVARCHAR (255) NULL,
    [1992]                NVARCHAR (255) NULL,
    [1993]                NVARCHAR (255) NULL,
    [1994]                NVARCHAR (255) NULL,
    [1995]                NVARCHAR (255) NULL,
    [1996]                NVARCHAR (255) NULL,
    [1997]                NVARCHAR (255) NULL,
    [1998]                NVARCHAR (255) NULL,
    [1999]                NVARCHAR (255) NULL,
    [2000]                NVARCHAR (255) NULL,
    [2001]                NVARCHAR (255) NULL,
    [2002]                NVARCHAR (255) NULL,
    [2003]                NVARCHAR (255) NULL,
    [2004]                NVARCHAR (255) NULL,
    [2005]                NVARCHAR (255) NULL,
    [2006]                NVARCHAR (255) NULL,
    [2007]                NVARCHAR (255) NULL,
    [2008]                NVARCHAR (255) NULL,
    [2009]                NVARCHAR (255) NULL,
    [2010]                NVARCHAR (255) NULL,
    [2011]                NVARCHAR (255) NULL,
    [2012]                NVARCHAR (255) NULL,
    [2013]                NVARCHAR (255) NULL,
    [2014]                NVARCHAR (255) NULL,
    [2015]                NVARCHAR (255) NULL,
    [SysDateCreated]      DATETIME       NULL,
    [SysSourceName]       NVARCHAR (255) NULL,
    CONSTRAINT [PK_stg_FactPopulationCleaned] PRIMARY KEY CLUSTERED ([WBPopulationDataKey] ASC)
);


GO
PRINT N'Creating [stg].[CountryMatched]...';


GO
CREATE TABLE [stg].[CountryMatched] (
    [CountryMatchedKey] INT            IDENTITY (1, 1) NOT NULL,
    [Country]           NVARCHAR (255) NULL,
    [Country1]          NVARCHAR (255) NULL,
    [Similarity]        FLOAT (53)     NULL,
    [Confidence]        FLOAT (53)     NULL,
    [SimCountry]        FLOAT (53)     NULL,
    [SysDateCreated]    DATETIME       NOT NULL,
    [SysDateChanged]    DATETIME       NOT NULL,
    PRIMARY KEY CLUSTERED ([CountryMatchedKey] ASC)
);


GO
PRINT N'Creating [stg].[UNCrimeData]...';


GO
CREATE TABLE [stg].[UNCrimeData] (
    [UNCrimeDataKey] INT            IDENTITY (1, 1) NOT NULL,
    [Region]         NVARCHAR (255) NULL,
    [SubRegion]      NVARCHAR (255) NULL,
    [Country]        NVARCHAR (255) NULL,
    [total2003]      NVARCHAR (255) NULL,
    [total2004]      NVARCHAR (255) NULL,
    [total2005]      NVARCHAR (255) NULL,
    [total2006]      NVARCHAR (255) NULL,
    [total2007]      NVARCHAR (255) NULL,
    [total2008]      NVARCHAR (255) NULL,
    [total2009]      NVARCHAR (255) NULL,
    [total2010]      NVARCHAR (255) NULL,
    [total2011]      NVARCHAR (255) NULL,
    [total2012]      NVARCHAR (255) NULL,
    [total2013]      NVARCHAR (255) NULL,
    [total2014]      NVARCHAR (255) NULL,
    [rate2003]       NVARCHAR (255) NULL,
    [rate2004]       NVARCHAR (255) NULL,
    [rate2005]       NVARCHAR (255) NULL,
    [rate2006]       NVARCHAR (255) NULL,
    [rate2007]       NVARCHAR (255) NULL,
    [rate2008]       NVARCHAR (255) NULL,
    [rate2009]       NVARCHAR (255) NULL,
    [rate2010]       NVARCHAR (255) NULL,
    [rate2011]       NVARCHAR (255) NULL,
    [rate2012]       NVARCHAR (255) NULL,
    [rate2013]       NVARCHAR (255) NULL,
    [rate2014]       NVARCHAR (255) NULL,
    [SysDateCreated] DATETIME       NULL,
    [SysSourceName]  NVARCHAR (255) NULL,
    CONSTRAINT [PK_stg_UNCrimeData] PRIMARY KEY CLUSTERED ([UNCrimeDataKey] ASC)
);


GO
PRINT N'Creating [stg].[WBPopulationData]...';


GO
CREATE TABLE [stg].[WBPopulationData] (
    [WBPopulationDataKey] INT            IDENTITY (1, 1) NOT NULL,
    [CountryName]         NVARCHAR (255) NULL,
    [CountryCode]         NVARCHAR (255) NULL,
    [IndicatorName]       NVARCHAR (255) NULL,
    [IndicatorCode]       NVARCHAR (255) NULL,
    [1960]                NVARCHAR (255) NULL,
    [1961]                NVARCHAR (255) NULL,
    [1962]                NVARCHAR (255) NULL,
    [1963]                NVARCHAR (255) NULL,
    [1964]                NVARCHAR (255) NULL,
    [1965]                NVARCHAR (255) NULL,
    [1966]                NVARCHAR (255) NULL,
    [1967]                NVARCHAR (255) NULL,
    [1968]                NVARCHAR (255) NULL,
    [1969]                NVARCHAR (255) NULL,
    [1970]                NVARCHAR (255) NULL,
    [1971]                NVARCHAR (255) NULL,
    [1972]                NVARCHAR (255) NULL,
    [1973]                NVARCHAR (255) NULL,
    [1974]                NVARCHAR (255) NULL,
    [1975]                NVARCHAR (255) NULL,
    [1976]                NVARCHAR (255) NULL,
    [1977]                NVARCHAR (255) NULL,
    [1978]                NVARCHAR (255) NULL,
    [1979]                NVARCHAR (255) NULL,
    [1980]                NVARCHAR (255) NULL,
    [1981]                NVARCHAR (255) NULL,
    [1982]                NVARCHAR (255) NULL,
    [1983]                NVARCHAR (255) NULL,
    [1984]                NVARCHAR (255) NULL,
    [1985]                NVARCHAR (255) NULL,
    [1986]                NVARCHAR (255) NULL,
    [1987]                NVARCHAR (255) NULL,
    [1988]                NVARCHAR (255) NULL,
    [1989]                NVARCHAR (255) NULL,
    [1990]                NVARCHAR (255) NULL,
    [1991]                NVARCHAR (255) NULL,
    [1992]                NVARCHAR (255) NULL,
    [1993]                NVARCHAR (255) NULL,
    [1994]                NVARCHAR (255) NULL,
    [1995]                NVARCHAR (255) NULL,
    [1996]                NVARCHAR (255) NULL,
    [1997]                NVARCHAR (255) NULL,
    [1998]                NVARCHAR (255) NULL,
    [1999]                NVARCHAR (255) NULL,
    [2000]                NVARCHAR (255) NULL,
    [2001]                NVARCHAR (255) NULL,
    [2002]                NVARCHAR (255) NULL,
    [2003]                NVARCHAR (255) NULL,
    [2004]                NVARCHAR (255) NULL,
    [2005]                NVARCHAR (255) NULL,
    [2006]                NVARCHAR (255) NULL,
    [2007]                NVARCHAR (255) NULL,
    [2008]                NVARCHAR (255) NULL,
    [2009]                NVARCHAR (255) NULL,
    [2010]                NVARCHAR (255) NULL,
    [2011]                NVARCHAR (255) NULL,
    [2012]                NVARCHAR (255) NULL,
    [2013]                NVARCHAR (255) NULL,
    [2014]                NVARCHAR (255) NULL,
    [2015]                NVARCHAR (255) NULL,
    [SysDateCreated]      DATETIME       NULL,
    [SysSourceName]       NVARCHAR (255) NULL,
    CONSTRAINT [PK_stg_WBPopulationData] PRIMARY KEY CLUSTERED ([WBPopulationDataKey] ASC)
);


GO
PRINT N'Creating [dwh].[DF_DWH_DimGeography_CreateDate]...';


GO
ALTER TABLE [dwh].[DimGeography]
    ADD CONSTRAINT [DF_DWH_DimGeography_CreateDate] DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating [dwh].[DF_DWH_DimGeography_ModifiedDate]...';


GO
ALTER TABLE [dwh].[DimGeography]
    ADD CONSTRAINT [DF_DWH_DimGeography_ModifiedDate] DEFAULT (getdate()) FOR [SysDateChanged];


GO
PRINT N'Creating [dwh].[DF_DWH_DimGeographySCD_CreateDate]...';


GO
ALTER TABLE [dwh].[DimGeographySCD]
    ADD CONSTRAINT [DF_DWH_DimGeographySCD_CreateDate] DEFAULT (getdate()) FOR [sysDateCreated];


GO
PRINT N'Creating [dwh].[DF_DWH_DimGeographySCD_ModifiedDate]...';


GO
ALTER TABLE [dwh].[DimGeographySCD]
    ADD CONSTRAINT [DF_DWH_DimGeographySCD_ModifiedDate] DEFAULT (getdate()) FOR [sysDateModified];


GO
PRINT N'Creating [dwh].[DF_DWH_FactCrime_CreateDate]...';


GO
ALTER TABLE [dwh].[FactCrime]
    ADD CONSTRAINT [DF_DWH_FactCrime_CreateDate] DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating [dwh].[DF_DWH_FactCrime_ModifiedDate]...';


GO
ALTER TABLE [dwh].[FactCrime]
    ADD CONSTRAINT [DF_DWH_FactCrime_ModifiedDate] DEFAULT (getdate()) FOR [SysDateChanged];


GO
PRINT N'Creating [dwh].[DF_DWH_FactPopulation_CreateDate]...';


GO
ALTER TABLE [dwh].[FactPopulation]
    ADD CONSTRAINT [DF_DWH_FactPopulation_CreateDate] DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating [dwh].[DF_DWH_FactPopulation_ModifiedDate]...';


GO
ALTER TABLE [dwh].[FactPopulation]
    ADD CONSTRAINT [DF_DWH_FactPopulation_ModifiedDate] DEFAULT (getdate()) FOR [SysDateChanged];


GO
PRINT N'Creating [dwh].[DF_DWH_DimCrimeType_CreateDate]...';


GO
ALTER TABLE [dwh].[DimCrimeType]
    ADD CONSTRAINT [DF_DWH_DimCrimeType_CreateDate] DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating [dwh].[DF_DWH_DimCrimeType_ModifiedDate]...';


GO
ALTER TABLE [dwh].[DimCrimeType]
    ADD CONSTRAINT [DF_DWH_DimCrimeType_ModifiedDate] DEFAULT (getdate()) FOR [SysDateChanged];


GO
PRINT N'Creating [stg].[DF_Test1_UNCD_Cleaned_sysDateCreated]...';


GO
ALTER TABLE [stg].[UNCrimeData_Cleaned]
    ADD CONSTRAINT [DF_Test1_UNCD_Cleaned_sysDateCreated] DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating [stg].[DF_STG_POPULTAION_Cleaned]...';


GO
ALTER TABLE [stg].[WBPopulationData_Cleaned]
    ADD CONSTRAINT [DF_STG_POPULTAION_Cleaned] DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating unnamed constraint on [stg].[CountryMatched]...';


GO
ALTER TABLE [stg].[CountryMatched]
    ADD DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating unnamed constraint on [stg].[CountryMatched]...';


GO
ALTER TABLE [stg].[CountryMatched]
    ADD DEFAULT (getdate()) FOR [SysDateChanged];


GO
PRINT N'Creating [stg].[DF_Test1_UNS_sysDateCreated]...';


GO
ALTER TABLE [stg].[UNCrimeData]
    ADD CONSTRAINT [DF_Test1_UNS_sysDateCreated] DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating [stg].[DF_STG_POPULTAION]...';


GO
ALTER TABLE [stg].[WBPopulationData]
    ADD CONSTRAINT [DF_STG_POPULTAION] DEFAULT (getdate()) FOR [SysDateCreated];


GO
PRINT N'Creating [dwh].[usp_UpdateDimDate]...';


GO

/****** Script for SelectTopNRows command from SSMS  ******/
CREATE PROCEDURE [dwh].[usp_UpdateDimDate]
	 @DateBegin	DATE
	,@DateEnd	DATE = NULL
AS

IF (@DateEnd IS NULL)
	SET @DateEnd = CAST(GETDATE() AS DATE);

IF (@DateEnd < @DateBegin)
BEGIN
	RAISERROR ('DateBegin must be <= DateEnd',10,1);
	GOTO Err;
END

DECLARE @d DATE = @DateBegin;

WHILE (@d <= @DateEnd)
BEGIN
	INSERT INTO dwh.DimDate
	(
		[DateSK]
		,[DateBK]
		,[CalendarMonth]
		,[CalendarMonthLongName]
		,[CalendarMonthShortName]
		,[CalendarQuarter]
		,[CalendarQuarterShortName]
		,[CalendarYear]
		,[CalendarYearMonth]
		,[CalendarYearQuarter]
		,[DayLongName]
		,[DayShortName]
		,[DayWeekNumber]
	)
	SELECT
		CAST(YEAR(@d) AS VARCHAR(4)) + 
			CASE WHEN MONTH(@d) < 10 THEN '0' + CAST(MONTH(@d) AS VARCHAR(1))
				ELSE CAST(MONTH(@d) AS VARCHAR(2))
			END + 
			CASE WHEN DAY(@d) < 10 THEN '0' + CAST(DAY(@d) AS VARCHAR(1))
				ELSE CAST(DAY(@d) AS VARCHAR(2))
			END
		,@d
		,MONTH(@d)
		,DATENAME(mm,@d)
		,LEFT(DATENAME(mm,@d),3)
		,DATEPART(qq,@d)
		,'Q' + CAST(DATEPART(qq,@d) AS VARCHAR(1))
		,YEAR(@d)
		,CAST(YEAR(@d) AS VARCHAR(4)) + '-' +
			CASE WHEN MONTH(@d) < 10 THEN '0' + CAST(MONTH(@d) AS VARCHAR(1))
				ELSE CAST(MONTH(@d) AS VARCHAR(2))
			END
		,CAST(YEAR(@d) AS VARCHAR(4)) + '-' +'Q' + CAST(DATEPART(qq,@d) AS VARCHAR(1))
		,DATENAME(dw,@d)
		,LEFT(DATENAME(dw,@d),3)
		,DATEPART(dw,@d)
	WHERE 
		NOT EXISTS (SELECT 1 FROM dwh.DimDate WHERE DateBK = @d);

	SET @d = DATEADD(dd,1,@d);
END

Err:

/*SELECT TOP 1000 [DateSK]
      ,[DateBK]
      ,[CalendarMonth]
      ,[CalendarMonthLongName]
      ,[CalendarMonthShortName]
      ,[CalendarQuarter]
      ,[CalendarQuarterShortName]
      ,[CalendarYear]
      ,[CalendarYearMonth]
      ,[CalendarYearQuarter]
      ,[DayLongName]
      ,[DayShortName]
      ,[DayWeekNumber]
  FROM [MSBI_CrimeStatistic_DEV].[dbo].[DimDate]*/
GO
PRINT N'Update complete.';


GO
